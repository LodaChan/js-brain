# 关于概念

> 方法 + uri + http版本

#### 从 url 到拿到 response

| 步骤  | 说明  |
| :------ | :-------------------------------- |
| url解析|拿到域名|
| 对域名进行DNS 解析 |  找到对应的IP地址，命中服务器 |
| TCP3次握手 |  完成TLS/SSL握手 |
| 构造http请求 |  装填上下文与参数，后发起http请求 |
| 浏览器端接收到http响应 |  包含返回的http响应头和body ， 浏览器根据content-type进行对应处理 |


#### http - 7层概念



| 层 | 作用 |
| :------ | :-------------------------------- |
| 物理层| 定义了物理介质，传输介质等信息|
| 数据链路层| 义了单链路数据传输协议 |
| 网络层| 定义了路由的方式 |
| 传输层| 规定是否进行差错恢复，数据复用，以及数据包排序等信息 |
| 会话层| 定义了会话开始、控制和终止的方式 |
| 表示层| 定义了数据的结构，2进制，或者ASCII码。和数据加密的方式 |
| 应用层| 计算机程序进行通信的应用，对应应用程序的通信服务，文件的传输需求时必须要实现 |

 
#### http 3次握手/4次挥手 - 白话版

| 名词 | 说明 |
| :------ | :-------------------------------- |
| syn| 同步 |
| seq| 序号|
| ack| 确认序号 |

 

+ `浏览器：服务器在吗？我想你和建立连接啊`
+ `服务器：我OK啊，你有什么需求`
+ `浏览器：我想要这样的处理 ， url 和 body 都发给你啦`
+ `服务器：收到啦，A few minutes later ... , 加上content-type，http code, 序列化发给你`
+ `浏览器：OK,哦，这样处理，好的`

#### http 80 3次握手/4次挥手 - 理论版


> 为什么要3次 ? 就是要在第1次的时候判断 浏览器 的网络情况 :)

+ client-server syn=1 seq=x
+ server-client syn=1 seq=y ack=x ack=x+1 
+ client-server       seq=z ack=y+    request header body
+ server-client             response header body


+ 客户端向服务器发出连接请求报文，这时报文首部中的同部位 `SYN=1`，同时随机生成初始序列号 `seq=x`，此时，TCP客户端进程进入了 `SYN-SENT`（同步已发送状态）状态。TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号。这个三次握手中的开始。表示客户端想要和服务端建立连接

+ TCP服务器收到请求报文后，如果同意连接，则发出确认报文。确认报文中应该 `ACK=1，SYN=1`，确认号是`ack=x+1`，同时也要为自己随机初始化一个序列号 `seq=y` ，此时，TCP服务器进程进入了 `SYN-RCVD（同步收到）`状态。这个报文也不能携带数据，但是同样要消耗一个序号。这个报文带有SYN(建立连接)和ACK(确认)标志，询问客户端是否准备好。

+ TCP客户进程收到确认后，还要向服务器给出确认。确认报文的 `ACK=1，ack=y+1`，此时，TCP连接建立，客户端进入`ESTABLISHED（已建立连接）`状态。TCP规定，ACK报文段可以携带数据，但是如果不携带数据则不消耗序号。这里客户端表示我已经准备好


#### tcp 443 3次握手/4次挥手 - 理论版

+  Ack = Seq + 传递的字节数 + 1
+  +1 是为了告诉对方要传递的 Seq

> 正常连接时，客户端突然挂掉了，如果没有措施处理这种情况，那么就会出现客户端和服务器端出现长时期的空闲。解决办法是在服务器端设置保活计时器，每当服务器收到客户端的消息，就将计时器复位。超时时间通常设置为2小时。若服务器超过2小时没收到客户的信息，他就发送探测报文段。若发送了10个探测报文段，每一个相隔75秒，还没有响应就认为客户端出了故障，因而终止该连接


#### SYN（洪水）攻击 


> 攻击客户端在短时间内伪造大量不存在的IP地址，向服务器不断地发送SYN包，服务器回复确认包，并等待客户的确认

假如没有超时控制，Linux下默认会进行5次重发SYN-ACK包，重试的间隔时间从1s开始，下次的重试间隔时间是前一次的双倍，5次的重试时间间隔为1s, 2s, 4s, 8s, 16s，总共31s，第5次发出后还要等32s都知道第5次也超时了，所以，总共需要 1s + 2s + 4s+ 8s+ 16s + 32s = 63s `微信开发的时候经常遇到`，TCP才会把断开这个连接。由于，SYN超时需要63秒，那么就给攻击者一个攻击服务器的机会，攻击者在短时间内发送大量的SYN包给Server(俗称SYN flood攻击)，用于耗尽Server的SYN队列


#### 简单说说 UDP 与 TCP 的区别

+ 无连接的，发送数据之前不需要建立连接
+ TCP保证数据正确性，UDP可能丢包，TCP保证数据顺序，UDP不保证
+ UDP具有较好的实时性，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信
+ TCP连接只能是点到点的;  UDP支持一对一，一对多，多对一和多对多的交互通信
+ TCP对系统资源要求较多，UDP对系统资源要求较少



#### https 过程

![https过程.png](https过程.png)

+ 服务器`非对称加密`,公钥加密的东西,只有私钥能解密
+ 浏览器`对称加密`
+ 服务器端的 `公钥` 和 `私钥`
+ 客户端 生成的 `随机密钥`
+ CA SSL第三方认证机构

+ 第1次HTTP请求
    + 1 客户端 向服务器发起HTTPS请求，连接到服务器的443端口
    + 2 服务器将自己的`公钥`和证书 发送给 客户端
    + 3 客户端 收到服务器端的证书之后，会对证书进行检查，验证其合法性 hash code , CA 对比 hash code 数字签名
    + 4 客户端 会生成一个 random key ,用服务器的公钥加密

+ 第2次HTTP请求
    + 5 将加密之后的 客户端 密钥 发送给服务器
    + 6 服务器使用 私钥 解密, 得到 random key
    + 7 服务器将使用 random key 对称加密 后的密文发送给 客户端

#### https常用加密算法

+ 非对称加密算法：RSA，DSA/DSS
+ 对称加密算法：AES，RC4，3DES
+ HASH算法：MD5，SHA1，SHA256


#### https 缺点

+ 加载时间延长近 50%，增加 10%到 20%的耗电
+ 还会影响缓存，增加数据开销和功耗
+ 在黑客攻击、拒绝服务攻击和服务器劫持等方面几乎起不到什么作用
+ SSL 协议加密算法和 SSL 交互次数将占用一定的计算资源和服务器成本