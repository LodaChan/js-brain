# Shader


## 渲染管线

渲染管线也称为渲染流水线或像素流水线或像素管线，
是显示芯片内部处理图形信号相互独立的的并行处理单元

最终生成1个二维纹理

统一渲染架构，大家可以理解为
将Vertex Shader（顶点着色器单元）、Pixel Pipelines（像素渲染管线）统一被 Stream Processors（流处理器）所取代

显卡中的GPU将不会开辟独立的渲染管线，而是 `所有的运算单元` 都可以`任意处理任何一种Shader运算`


## 流程

+ 应用阶段 -> 输出渲染图元
+ 几何阶段 ->输出屏幕空间的顶点信息
+ 光栅化阶段


## 应用阶段

应用阶段是用户可编程程度最高的步骤，通常是由CPU负责的部分。这个阶段主要任务是：
+ 准备好场景数据（包括需要渲染的物体、摄像机角度等）
+ 进行粗粒度的剔除（剔除被遮挡的物体，与光栅化阶段有所不同）
+ 设置每个模型的渲染状态（包括使用的材质、纹理、shader等）

该阶段的最终输出就是渲染所需的几何信息，即渲染图元，重点是`三维信息`！
 
## 几何阶段

几何阶段的主要工作是将上一步的渲染图元进行逐顶点、逐边的操作。
通俗来说就是决定需要绘制的图元是什么，绘制在什么位置，如何绘制等等。

这里的遮挡计算与应用阶段不同，应用阶段进行的是粗粒度的剔除，即完全被遮挡的物体会直接被剔除，以减少之后几何阶段的计算等。

而几何阶段则需要计算各图元之间的部分遮挡，即一个图元哪些部分被遮挡不需绘制，哪些部分未被遮挡需要绘制。

其中最重要的一项工作就是将顶点坐标转换到屏幕空间中。该阶段通常在`GPU`上进行`坐标装欢`，最终输出是屏幕空间的二维顶点坐标、每个顶点的相关信息等，重点是`二维信息`！


## 光栅化阶段

光栅化阶段主要使用上一阶段提供的数据来产生屏幕上的像素。

这个阶段的主要任务是决定每个渲染图元中的哪些像素需要被绘制出来，这里需要用到上阶段提供的逐顶点信息，进行插值，进行逐像素的处理。

## CPU与GPU的通信

通过上面我们了解到渲染流水线的开始是应用阶段，而`应用阶段主要是由CPU进行`，因此`整个渲染过程也是由CPU发起`，之后`交由GPU进行处理`。主要分为三个阶段：

+ 1 加载数据至显存（硬盘->内存->显存）
+ 2 设置渲染状态（使用的材质、纹理、shader等）
+ 3 发起DrawCall（CPU调用图形编程接口，比如DirectX或OpenGL，来命令GPU进行渲染的操作），告诉GPU已经准备好渲染所需信息，可以开始工作啦

+ 4  CPU和GPU并行工作的原理
https://www.jianshu.com/p/061b84e4f863



// todo
https://www.jianshu.com/nb/45631428